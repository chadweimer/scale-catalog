groups:
  - name: Configuration
    description: Configuration

portals:
  open:
    protocols:
      - "http"
    host:
      - "$node_ip"
    ports:
      - "$variable-gomp.service.nodePort"

questions:
  - variable: gomp
    label: Application Configuration
    group: Configuration
    schema:
      type: dict
      attrs:
        - variable: image
          label: Container Image
          schema:
            type: dict
            attrs:
              - variable: tag
                label: Override Tag
                schema:
                  type: string
                  default: ""
        - variable: gomp
          label: Settings
          schema:
            type: dict
            attrs:
              - variable: secureKey
                label: Secure Key
                description: Used for encrypting tokens
                schema:
                  type: string
                  default: ""
                  required: true
        - variable: service
          label: Main Service
          schema:
            type: dict
            attrs:
              - variable: nodePort
                label: Web Port
                schema:
                  type: int
                  min: 8000
                  max: 65535
                  default: 15000
                  required: true
        - variable: persistence
          label: Storage
          schema:
            type: dict
            attrs:
              - variable: data
                label: Application Data
                schema:
                  type: dict
                  attrs:
                    - variable: type
                      label: Type of Storage
                      description: Sets the persistence type
                      schema:
                        type: string
                        default: pvc
                        required: true
                        enum:
                          - value: pvc
                            description: PVC
                          - value: hostPath
                            description: Host Path
                    - variable: size
                      label: PVC Size
                      description: Set the PVC size
                      schema:
                        type: string
                        valid_chars: "^([+-]?[0-9.]+)([eEinumkKMGTP]*[-+]?[0-9]*)$"
                        default: 1Gi
                        show_if: [["type", "=", "pvc"]]
                    - variable: hostPath
                      label: Host Path
                      description: Select the host path
                      schema:
                        type: hostpath
                        required: true
                        show_if: [["type", "=", "hostPath"]]
        - variable: resources
          label: Resources
          schema:
            type: dict
            attrs:
              - variable: limits
                label: Limits
                schema:
                  type: dict
                  attrs:
                    - variable: enableResourceLimits
                      label: Enable Pod resource limits
                      schema:
                        type: boolean
                        default: false
                    - variable: cpu
                      label: CPU
                      description: CPU resource limit allow  plain integer values with suffix m(milli) e.g 1000m, 100.
                      schema:
                        type: string
                        valid_chars: "^\\d+(?:\\.\\d+(?!.*m$)|m?$)"
                        default: 1000m
                        show_if: [["enableResourceLimits", "=", true]]
                    - variable: memory
                      label: Memory
                      description: Memory limits is specified by number of bytes. Followed by quantity suffix like E,P,T,G,M,k and Ei,Pi,Ti,Mi,Gi,Ki can also be used. e.g 129e6, 129M,  128974848000m, 123Mi
                      schema:
                        type: string
                        valid_chars: "^([+-]?[0-9.]+)([eEinumkKMGTP]*[-+]?[0-9]*)$"
                        default: "1Gi"
                        show_if: [["enableResourceLimits", "=", true]]
        - variable: postgresql
          label: PostgreSQL
          schema:
            type: dict
            attrs:
              - variable: enabled
                label: Enabled
                schema:
                  type: boolean
                  default: false
              - variable: auth
                label: Authentication
                schema:
                  type: dict
                  show_if: [["enabled", "=", true]]
                  attrs:
                    - variable: password
                      label: Database Password
                      schema:
                        type: string
                        default: ""
                        required: true
              - variable: primary
                label: Primary
                schema:
                  type: dict
                  show_if: [["enabled", "=", true]]
                  attrs:
                    - variable: persistence
                      label: Default Storage (PVC)
                      schema:
                        type: dict
                        attrs:
                          - variable: enabled
                            label: Enabled
                            schema:
                              type: boolean
                              default: true
                    - variable: extraVolumes
                      label: Extra Host Path Volumes
                      schema:
                        type: list
                        default: []
                        items:
                          - variable: extraVolumesEntry
                            label: Custom Volume
                            schema:
                              additional_attrs: true
                              type: dict
                              attrs:
                                - variable: name
                                  label: Volume Name
                                  schema:
                                    type: string
                                    default: ""
                                    required: true
                                - variable: hostPath
                                  label: Host Path
                                  schema:
                                    type: dict
                                    attrs:
                                      - variable: path
                                        label: Path
                                        description: Select the host path
                                        schema:
                                          type: hostpath
                                          required: true
                    - variable: extraVolumeMounts
                      label: Extra Host Path Volume Mounts
                      description: MUST have a corresponding Host Path Volume defined
                      schema:
                        type: list
                        default: []
                        items:
                          - variable: extraVolumeMountsEntry
                            label: Custom Volume Mount
                            schema:
                              additional_attrs: true
                              type: dict
                              attrs:
                                - variable: name
                                  label: Volume Name
                                  schema:
                                    type: string
                                    default: ""
                                    required: true
                                - variable: mountPath
                                  label: Mount Path
                                  schema:
                                    type: path
                                    required: true
                                - variable: subPath
                                  label: Mount Sub-Path
                                  schema:
                                    type: string
                                    default: ""